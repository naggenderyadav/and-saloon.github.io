<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Staff Panel - A & D Salon</title>
  <style>
    body{font-family:Inter,Arial,sans-serif;margin:0;background:#f4f6f9;color:#14212c}
    header{background:#1f3b73;color:#fff;padding:18px;text-align:center}
    .container{max-width:1100px;margin:18px auto;padding:16px}
    .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(20,30,50,0.06)}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #eef2f7;padding:10px;text-align:center}
    th{background:#1f3b73;color:#fff}
    select{padding:8px;border-radius:6px}
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .logout{background:#e74c3c;color:#fff;padding:8px 12px;border:none;border-radius:6px}
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <header><h2>Staff Panel â€” A & D Unisex Salon</h2></header>
  <div class="container">
    <div id="mainArea" class="card" style="display:none">
      <div class="top">
        <strong>Today's Queue</strong>
        <div>
          <button id="logoutBtn" class="logout">Logout</button>
        </div>
      </div>
      <table>
        <thead><tr><th>Serial</th><th>Date & Time</th><th>Name</th><th>Contact</th><th>Payment</th><th>Status</th></tr></thead>
        <tbody id="adminQueue"></tbody>
      </table>
    </div>

    <div id="blocked" class="card" style="text-align:center">
      <p style="font-weight:700">Restricted</p>
      <p>Staff-only panel. Please login to continue.</p>
      <button id="loginBtn">Staff Login</button>
    </div>
  </div>

<script>
  // ---------- Firebase config ----------
  const firebaseConfig = {
    apiKey: "AIzaSyAQJuNHQBu8OHmmz2DPVSSkv9Mj_l3im_g",
    authDomain: "and-unisex-salon.firebaseapp.com",
    databaseURL: "https://and-unisex-salon-default-rtdb.firebaseio.com",
    projectId: "and-unisex-salon",
    storageBucket: "and-unisex-salon.appspot.com",
    messagingSenderId: "369436182781",
    appId: "1:369436182781:web:893b3b8db919b89bb59694"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const STAFF_PASSWORD = "staff123"; // change this to something secure
  const LOGIN_KEY = 'ad_salon_staff_logged';

  function showMain(){ document.getElementById('mainArea').style.display='block'; document.getElementById('blocked').style.display='none'; loadQueue(); }
  function hideMain(){ document.getElementById('mainArea').style.display='none'; document.getElementById('blocked').style.display='block'; }

  // Login flow
  document.getElementById('loginBtn').addEventListener('click', ()=> {
    const p = prompt('Enter staff password:');
    if(p && p === STAFF_PASSWORD){
      localStorage.setItem(LOGIN_KEY,'1'); showMain();
    } else { alert('Incorrect password'); }
  });
  document.getElementById('logoutBtn').addEventListener('click', ()=>{ localStorage.removeItem(LOGIN_KEY); hideMain(); });

  // Auto-check login
  if(localStorage.getItem(LOGIN_KEY) === '1'){ showMain(); } else { hideMain(); }

  // Load today's queue and show editable dropdowns
  function loadQueue(){
    const today = new Date().toISOString().split('T')[0];
    const ref = db.ref("bookings/"+today);
    ref.on('value', snap=>{
      const tbody = document.getElementById('adminQueue'); tbody.innerHTML='';
      if(!snap.exists()){ tbody.innerHTML = '<tr><td colspan="6" style="padding:18px;color:#666">No bookings today.</td></tr>'; return; }
      const data = snap.val();
      Object.values(data).sort((a,b)=>a.serial.localeCompare(b.serial)).forEach(item=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.serial}</td>
                        <td>${item.datetime}</td>
                        <td>${item.name}</td>
                        <td>${item.contact}</td>
                        <td>
                          <select onchange="updateField('${today}','${item.serial}','paymentStatus',this.value)">
                            <option ${item.paymentStatus==='Pending'?'selected':''}>Pending</option>
                            <option ${item.paymentStatus==='Done'?'selected':''}>Done</option>
                          </select>
                        </td>
                        <td>
                          <select onchange="updateField('${today}','${item.serial}','serviceStatus',this.value)">
                            <option ${item.serviceStatus==='Waiting'?'selected':''}>Waiting</option>
                            <option ${item.serviceStatus==='Serving'?'selected':''}>Serving</option>
                            <option ${item.serviceStatus==='Done'?'selected':''}>Done</option>
                          </select>
                        </td>`;
        tbody.appendChild(tr);
      });
    }, err => { console.error('admin load err', err); });
  }

  // Expose updateField to inline handlers
  window.updateField = function(date,serial,field,val){
    try{
      db.ref("bookings/"+date+"/"+serial+"/"+field).set(val);
    }catch(e){ console.error(e); alert('Update failed'); }
  };
</script>
</body>
</html>
